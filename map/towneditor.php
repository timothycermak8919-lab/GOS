<?php
	// TILE SETS LIST
	$tilesets=array(
	'(All Tiles)',
	'grass',
	'farm',
	'forest',
	'stedding',
	'blight',
	'water',
	'edge_d',
	'edge',
	'building_grass',
	'resources_grass',
	'waste',
	);
	// TILE LIST
	$tiles=array(
	// GRASS
	'grass',
	'grass_2trees',
	'grass_2trees2',
	'grass_2trees3',
	'grass_2trees_trunk',
	'grass_3trees',
	'grass_3trees2',
	'grass_3treestrunk',
	'grass_oak1',
	'grass_oak2',
	'grass_oak3',
	'grass_small_tree1',
	'grass_weird_tree1',
	'grass_trees_aU',
	'grass_trees_L',
	'grass_',
	'grass_hut_left',
	'grass_hut_right',
	'grass_cart1',
	'grass_',
	'grass_tree_pine',
	'grass_tree_pine2',
	'grass_tree_trunk',
	'grass_tree_trunks',
	'grass_rock',
	'grass_rock2',
	'grass_rock3',
	'grass_bones',
	// FARM
	'farm_house1',
	'farm_house2',
	'farm_flowers1',
	'farm_large_farm1_aUL',
	'farm_large_farm2_aUL',
	'farm_large_farm3_aUL',
	'farm_small_horz_farm1',
	'farm_small_horz_farm2',
	'farm_small_horz_farm3',
	'farm_small_vert_farm1',
	'farm_small_vert_farm2',
	'farm_small_vert_farm3',
	// WATER
	'water_shallow',
	'water_basic',
	// EDGES
	'edge_stone_bridge1_aUL',
	'edge_wooden_bridgeL',
	'edge_wooden_bridgeR',
	'edge_',
	'edge_grass_waves_water',
	'edge_water_waves_grass',
	'edge_water_up',
	'edge_water_down',
	'edge_',
	'edge_water_corner_1',
	'edge_water_corner_2',
	'edge_water_corner_3',
	'edge_water_corner_4',
	'edge_',
	'edge_grass_corner_1',
	'edge_grass_corner_2',
	'edge_grass_corner_3',
	'edge_grass_corner_4',
	// EDGE DEEP WATER
	'edge_d_RL_LW',
	'edge_d_RL_WL',
	'edge_d_UD_LW',
	'edge_d_UD_WL',
	'edge_d_',
	'edge_d_LLLbend_aUL',
	'edge_d_LLLhorizcurve_aUL',
	'edge_d_ULLbend_aUL',
	'edge_d_ULLcurve_aUL',
	'edge_d_LRLbend_aUL',
	'edge_d_URLcurve_aUL',
	'edge_d_ULLhorizcurve_aUL',
	'edge_d_',
	'edge_d_LLWbend_aUL',
	'edge_d_LLWhorizcurve_aUL',
	'edge_d_LRWbend_aUL',
	'edge_d_ULWbend_aUL',
	'edge_d_ULWcurve_aUL',
	'edge_d_ULWhorizcurve_aUL',
	'edge_d_URWbend_aUL',
	'edge_d_URWcurve_aUL',
	// FOREST
	'forest_UL',
	'forest_UR',
	'forest_ML',
	'forest_MR',
	'forest_LL',
	'forest_two_aU',
	'forest_two_L',
	'forest_large_tree1_aUL',
	'forest_large_tree2_aUL',
	'forest_large_tree3_aUL',
	// BUILDINGS
	'building_grass_basic_inn_aUL_plTavern',
	'building_grass_stable_aUL_plStable',
	'building_grass_blacksmith_aUL_plBlacksmith',
	'building_grass_market_aUL_plMarketplace',
	'building_grass_bank_aUL_plBank',
	'building_grass_armory_aUL_plArmory',
	'building_grass_inntavern_aUL_plTavern',
	'building_grass_org_aUL_plTrading_Post',
	'building_grass_mayor_aUL',
	// DOCKS
	'building_grass_',
	'building_grass_dock_aUL_plDock',
	'building_grass_dock2_aUL_plDock',
	'building_grass_dock3_aUL_plDock',
	'building_grass_river_dock1_aUL_plDock',
	'building_grass_river_dock2_aUL_plDock',
	'building_grass_river_dock3_aUL_plDock',
	'building_grass_',
	'building_grass_ocean_dock1_aUL_plDock',
	'building_grass_ocean_dock1_UFR_plDock',
	'building_grass_ocean_dock1_LFR_plDock',
	'building_grass_ocean_dock1_FLFR_plDock',
	'building_grass_ocean_dock1_FLR_plDock',
	'building_grass_ocean_dock1_FLL_plDock',
	'building_grass_',
	'building_grass_ocean_dock2_top_aUL_plDock',
	'building_grass_ocean_dock2_bottom_aUL_plDock',
	// BUILDING/COBBLESTONE CONNECTIONS
	'building_grass_',
	'building_grass_stable_cLR_plStable',
	'building_grass_blacksmith_cLL_plBlacksmith',
	'building_grass_market_cLR_plMarketplace',
	'building_grass_bank_cLL_plBank',
	'building_grass_armory_cLR',
	'building_grass_inntavern_cLR_plTavern',
	'building_grass_org_cLL',
	'building_grass_mayor_cLL',
	'building_grass_',
	'building_grass_basic_thatch_aUL',
	'building_grass_basic_wood_aUL',
	'building_grass_basic_tile_aUL',
	// RESOURCES
	'resources_grass_mine_aUL',
	'resources_grass_hunt_aUL',
	'resources_grass_cutwood_aUL',
	// COBBLESTONE
	'cobblestone_stone',
	'cobblestone_across',
	'cobblestone_updown',
	'cobblestone_UR',
	'cobblestone_UL',
	'cobblestone_LR',
	'cobblestone_LL',
	// BLIGHT
	'blight_dirt',
	'blight_lava1',
	'blight_lava2',
	'blight_lava3',
	'blight_lava4',
	'blight_lava_bones',
	'blight_bones',
	'blight_rock',
	'blight_trees',
	'blight_trees2',
	'blight_trees3',
	'blight_trees4',
	'blight_dirt1',
	'blight_dirt2',
	'blight_trolloc_camp1_aUL',
	'blight_trolloc_camp2',
	'blight_trolloc_camp3',
	// WASTE
	'waste_basic',
	'waste_puddle1',
	'waste_puddle2',
	'waste_cracked_earth1_aUL',
	'waste_cracked_earth2',
	'waste_cracked_earth3',
	'waste_',
	'waste_rock1',
	'waste_rock2',
	'waste_rock3',
	'waste_rock4',
	'waste_rock5',
	'waste_rock6',
	// STEDDING
	'stedding_ogier1_aUL',
	'stedding_ogier2',
	'stedding_ogier3_aUL',
	);

	// VARIABLES
	$map_width = 6;
	$map_height = 6;
	if (intval($_REQUEST[w])) $map_width = abs(intval($_REQUEST[w]));
	if (intval($_REQUEST[h])) $map_height = abs(intval($_REQUEST[h]));
	if ($map_width>12) $map_width=12;
	if ($map_height>12) $map_height=12;
	$default_tile="grass";
	$edit[0]=1;
	$edit[1]="onClick='SetTileBack(this)'";
?>
<html>
<head>
	<?php
		if ($_REQUEST['map_x']) {
			echo "<b>Coordinate Request</b>:<br>x= ".$_REQUEST['map_x']."<br>y= ".$_REQUEST['map_y']."<br><br>";
		} 
	?>
	<SCRIPT LANGUAGE="JavaScript">
	var MapWidth = <?php echo $map_width; ?>;
	var MapHeight = <?php echo $map_height; ?>;
	var CurrentTile = 'grass';
	var TilePlace = '';
	var CurrentTileSet = 'grass_';
	var AutoComplete = 1;
	tile_list = new Array();
	auto_comp = new Array();
	
	preload_image_object = new Image();
      // IMG URLS
      image_url = new Array();
      <?php
      for ($x=0; $x<count($tiles); $x++) {
      	echo "image_url[$x] = 'tiles/".$tiles[$x].".gif';\n";
      	echo "tile_list[$x] = '".$tiles[$x]."';\n";
      }
      ?>
      // PRELOAD
		var i = 0;
		for(i=0; i<=<?php echo count($tiles); ?>; i++)
			preload_image_object.src = image_url[i];
         
	function SetGrid(set)
	{
		document.getElementById('TownMap').border=set;
	}
	
	function SetTileType(set)
	{
		if (set.replace(CurrentTileSet+'_','')!='')
		{
			CurrentTile=set.replace(/_pl.*/,'');
			var tempVar=set.indexOf('_pl')+1;
			if (tempVar) TilePlace=set.slice(tempVar+2);
			else TilePlace='';
			document.getElementById('infoSet').innerHTML='Current Tile: <b>'+CurrentTile+'.gif</b>';
			if (set.indexOf('_aUL')==-1) document.getElementById('tileimg').innerHTML='<img src=tiles/'+CurrentTile+'.gif>';
			else document.getElementById('tileimg').innerHTML='<table border=0 cellpadding=0 cellspacing=0><tr><td><img src=tiles/'+CurrentTile+'.gif width=75 height=50></td><td><img src=tiles/'+CurrentTile.replace('_aUL','_UR')+'.gif width=75 height=50></td></tr><tr><td><img src=tiles/'+CurrentTile.replace('_aUL','_LL')+'.gif width=75 height=50></td><td><img src=tiles/'+CurrentTile.replace('_aUL','_LR')+'.gif width=75 height=50></td></tr></table>';
		}
	}
	
	function ShowText(sometext)
	{
		document.getElementById('infoSet').innerHTML=sometext;
	}
	
	function ToThe(dir)
	{
		if (dir==1) place=document.getElementById('n');
		if (dir==2) place=document.getElementById('s');
		if (dir==3) place=document.getElementById('e');
		if (dir==4) place=document.getElementById('w');
		if (dir==5) place=document.getElementById('d1');
		if (dir==6) place=document.getElementById('d2');
		if (dir==7) place=document.getElementById('d3');
		return place.value.replace(' ','_').replace(' ','_').replace(' ','_');
	}
	
	function tToThe(dir)
	{
		if (dir==1) place=document.getElementById('nt');
		if (dir==2) place=document.getElementById('st');
		if (dir==3) place=document.getElementById('et');
		if (dir==4) place=document.getElementById('wt');
		return place.value;
	}
	
	function SetTileSet(set)
	{
		CurrentTileSet=set;
		document.getElementById('tileslist').options.length=0;
		var i = 0;
		var j = 0;
		var sel = true;
		for(i=0; i<=<?php echo count($tiles); ?>; i++)
		{
			if (tile_list[i].indexOf(CurrentTileSet)==0 || CurrentTileSet=='(All Tiles)')
			{
				document.getElementById('tileslist').options[j]=new Option(tile_list[i].replace(CurrentTileSet+'_',''),tile_list[i],sel,sel);
				if (j==0) {SetTileType(tile_list[i]); sel=false;}
				j++;
				if (AutoComplete==0 && tile_list[i].search("_aUL")!=-1) {
					document.getElementById('tileslist').options[j]=new Option(tile_list[i].replace(CurrentTileSet+'_','').replace('_aUL','_UR'),tile_list[i].replace('_aUL','_UR'),sel,sel);
					j++;
					document.getElementById('tileslist').options[j]=new Option(tile_list[i].replace(CurrentTileSet+'_','').replace('_aUL','_LR'),tile_list[i].replace('_aUL','_LR'),sel,sel);
					j++;
					document.getElementById('tileslist').options[j]=new Option(tile_list[i].replace(CurrentTileSet+'_','').replace('_aUL','_LL'),tile_list[i].replace('_aUL','_LL'),sel,sel);
					j++;
				}
			}
		}
	}
	
	function SetTileBack(set)
	{
		set.src='tiles/'+CurrentTile+'.gif';
		document.getElementById(set.id+'l').name=TilePlace;
		// AUTO COMPLETE
		if (AutoComplete==1)
		{
			if (CurrentTile.indexOf('_aU')!=-1)
			{
				var info=set.id.split("_");
				if (parseInt(info[1],10)<MapHeight-1) {document.getElementById(info[0]+'_'+(parseInt(info[1],10)+1)).src='tiles/'+CurrentTile.replace('_aU','_L')+'.gif';
				document.getElementById(info[0]+'_'+(parseInt(info[1],10)+1)+'l').name=TilePlace;}
			}
			if (CurrentTile.indexOf('_aUL')!=-1)
			{
				var info=set.id.split("_");
				if (parseInt(info[1],10)<MapHeight-1) {document.getElementById(info[0]+'_'+(parseInt(info[1],10)+1)).src='tiles/'+CurrentTile.replace(/_aUL.*/,'_LL')+'.gif';
				document.getElementById(info[0]+'_'+(parseInt(info[1],10)+1)+'l').name=TilePlace;}
				if (parseInt(info[0],10)<MapWidth-1) {document.getElementById((parseInt(info[0],10)+1)+'_'+info[1]).src='tiles/'+CurrentTile.replace(/_aUL.*/,'_UR')+'.gif';
				document.getElementById((parseInt(info[0],10)+1)+'_'+info[1]+'l').name=TilePlace;}
				if (parseInt(info[1],10)<MapHeight-1 && parseInt(info[0],10)<MapWidth-1) {document.getElementById((parseInt(info[0],10)+1)+'_'+(parseInt(info[1],10)+1)).src='tiles/'+CurrentTile.replace(/_aUL.*/,'_LR')+'.gif';
				document.getElementById((parseInt(info[0],10)+1)+'_'+(parseInt(info[1],10)+1)+'l').name=TilePlace;}
				if (CurrentTile.indexOf('edge_d')!=-1) {
					var name = CurrentTile.replace('edge_d_','').replace('_aUL','');
					if (name[2]=='L') var tile_r = 'grass.gif';
					else if (name[2]=='W') var tile_r = 'water_basic.gif';
					if (name[0]=='U') var off_y = 0;
					else var off_y = 1;
					if (name[1]=='L') var off_x = 0;
					else var off_x = 1;
					document.getElementById((parseInt(info[0],10)+off_x)+'_'+(parseInt(info[1],10)+off_y)).src='tiles/'+tile_r;
					document.getElementById((parseInt(info[0],10)+off_x)+'_'+(parseInt(info[1],10)+off_y)+'l').name='';
				}
			}
		}
	}
	
	function SaveMap(saveTo)
	{
		save=MapWidth+'|'+MapHeight+'|'+ToThe(1)+'|'+ToThe(2)+'|'+ToThe(3)+'|'+ToThe(4)+'|'+ToThe(5)+'|'+ToThe(6)+'|'+ToThe(7)+'|'+tToThe(1)+'|'+tToThe(2)+'|'+tToThe(3)+'|'+tToThe(4);
		var x=0;
		var y=0;
		for(y=0; y<MapHeight; y++)
		{
			save+='#\n';
			for(x=0; x<MapWidth; x++)
			{
				save+=document.getElementById(x.toString()+'_'+y.toString()).src.replace(/.*tiles\//,'').replace('.gif','');
				save+=':';
				save+=document.getElementById(x.toString()+'_'+y.toString()+'l').name;
				if (x<MapWidth-1) save+='|';
			}
		}
		saveTo.value=save;
		ShowText('<b>SAVED MAP SUCCESSFULLY</b>');
	}
	
	function LoadMap(saveData)
	{
		saveData=saveData.replace(' ','').replace('%20','');
		var error='';
		var note='';
		var x=0;
		var y=0;
		var tmpCellData='';
		var thedata=saveData.split('#');
		var tmpRowData=thedata[0].split('|');
		var orgLoadWidth=tmpRowData[0];
		var orgLoadHeight=tmpRowData[1];
		var LoadWidth=tmpRowData[0];
		var LoadHeight=tmpRowData[1];
		if (MapWidth<LoadWidth) LoadWidth=MapWidth;
		if (MapHeight<LoadHeight) LoadHeight=MapHeight;
		if (MapWidth!=tmpRowData[0] || MapHeight!=tmpRowData[1]) note='<br>Load/Current Map dimensions did not match, it was originally: w'+tmpRowData[0]+' h'+tmpRowData[1];
		if (typeof tmpRowData[12] != "undefined")
		{
			document.getElementById('n').value=tmpRowData[2].replace('_',' ');
			document.getElementById('s').value=tmpRowData[3].replace('_',' ');
			document.getElementById('e').value=tmpRowData[4].replace('_',' ');
			document.getElementById('w').value=tmpRowData[5].replace('_',' ');
			document.getElementById('nt').value=tmpRowData[9];
			document.getElementById('st').value=tmpRowData[10];
			document.getElementById('et').value=tmpRowData[11];
			document.getElementById('wt').value=tmpRowData[12];
			document.getElementById('d1').value=tmpRowData[6].replace('_',' ');
			document.getElementById('d2').value=tmpRowData[7].replace('_',' ');
			document.getElementById('d3').value=tmpRowData[8].replace('_',' ');
		}
		else error='<br>Map Data Corrupt, missing surrounding area data';
		if (orgLoadHeight!=thedata.length-1) error='<br>Map Data Corrupt, wrong number of rows';
		if (!error)
		{
			for(y=0; y<LoadHeight; y++)
			{
				tmpRowData=thedata[y+1].split('|');
				if (orgLoadWidth==tmpRowData.length)
				{
					for(x=0; x<LoadWidth; x++)
					{
						tmpCellData=tmpRowData[x].split(':');
						if (tmpCellData[0]!='')
						{
							document.getElementById(x.toString()+'_'+y.toString()).src='tiles/'+tmpCellData[0]+'.gif';
							document.getElementById(x.toString()+'_'+y.toString()+'l').name=tmpCellData[1];
						}
						else note+='<br>Cell Ignored, contents corrupt: row '+(y+1)+', column '+(x+1);
					}
				}
				else error='<br>Map Data Corrupt, inconsistent # of columns';
			}
		}
		if (error) {ShowText('<b>ERROR LOADING MAP</b> '+error); return false;}
		else {ShowText('<b>LOADED MAP SUCCESSFULLY</b>'+note); save=saveData; return true;}
	}
	
	function SetAutoComplete(set)
	{
		AutoComplete=set;
		SetTileSet(CurrentTileSet);
	}

	
	</SCRIPT>
</head>
<body bgcolor="white">

<table id="TownMap" border="0" cellpadding="0" cellspacing="0" style="border-color: #000000;">
<?php
	for ($y=0; $y<$map_height; $y++)
	{
		echo "<tr>";
		for ($x=0; $x<$map_width; $x++)
		{
			$tile_code = "<td width='75' height='50' bgcolor='darkgreen'><a name='' onMouseOver='ShowText(this.name)' id='$x"."_".$y."l'><img id='$x"."_"."$y' src='tiles/$default_tile.gif' border='0' ".$edit[1]."></a></td>";
			echo $tile_code;
		}
		echo "</tr>\n";
	}
?>
</table>
<table><tr><td id="infoSet" height="50">Current Tile: (none)</td></tr></table>

<noscript>
	<br><br>Javascript is not enabled, none of the below functions will work.<br><br>
</noscript>

<table border="1" cellpadding="10"><tr><td width="500" valign="top">
<b>editor</b><br>

<form>
<table border="0" cellpadding="7" cellspacing="0">
	<tr>
		<td valign="top">
			<br>
			Tile Set: 
			<select name="tilesets" id="tileSetSelector" onChange="SetTileSet(this.options[selectedIndex].innerHTML);" size="1">
			<?php
				for ($x=0; $x<count($tilesets); $x++)
				{
					echo "<option>".$tilesets[$x]."</option>\n";
				}
			?>
			</select>
			<br><br>&nbsp;&nbsp;&nbsp;<div><table width="75" height="50" cellpadding="0" cellspacing="0" border="0"><tr><td id="tileimg"></td></tr></table></div><br>
		</td>
		<td valign="top">
			<select name="tileslist" id="tileslist" onChange="SetTileType(this.options[selectedIndex].value);" size="10">
				<option value="grass">(select a tile set)</option>
			</select>
		</td>
	</tr>
</table>
<br>
	Grid: 
	<select name="border" onChange="SetGrid(this.options[selectedIndex].value);" size="1">
		<option value="0">Off</option>
		<option value="1">On</option>
	</select>
	<br><br>
	Auto Complete:<br> 
	<select name="auto" onChange="SetAutoComplete(this.options[selectedIndex].value);" size="1">
		<option value="1">On (hide UR,LR,LL)</option>
		<option value="0">Off (show UR,LR,LL)</option>
	</select>
</form>

</td><td valign="top">
<b>loader/saver</b><br><br>

<!-- SAVE AND LOAD AREA -->
<form>
	<input type="button" onClick="SaveMap(document.getElementById('SLOutput'));" value="Save">
	<input type="button" onClick="if(LoadMap(document.getElementById('SLOutput').value)) document.getElementById('SLOutput').value='';" value="Load">
	&nbsp;&nbsp;&nbsp;&nbsp;
	<input type="button" onClick="document.getElementById('SLOutput').value=save;" value="Last Save/Load &crarr;">
	<br>
	<TEXTAREA id="SLOutput" rows="7" cols="50" wrap="soft"></TEXTAREA>
	<br>
	<input type="button" onClick="document.getElementById('SLOutput').focus(); document.getElementById('SLOutput').select();" value="Select All">
	<input type="reset" value="&otimes; Clear &otimes;">
</form>

<!-- CHANGE MAP SIZE -->
<br>
<form>
	<b>Surrounding Towns</b>:
	<br>N: <input type="text" size="20" value="" maxlength="45" id="n"> | t <input type="text" size="3" value="" maxlength="3" id="nt">
	<br>S: <input type="text" size="20" value="" maxlength="45" id="s"> | t <input type="text" size="3" value="" maxlength="3" id="st">
	<br>E: <input type="text" size="20" value="" maxlength="45" id="e"> | t <input type="text" size="3" value="" maxlength="3" id="et">
	<br>W: <input type="text" size="20" value="" maxlength="45" id="w"> | t <input type="text" size="3" value="" maxlength="3" id="wt">
	<br>
	Dock Goes To:
	<br>1. <input type="text" size="20" value="" maxlength="45" id="d1">
	<br>2. <input type="text" size="20" value="" maxlength="45" id="d2">
	<br>3. <input type="text" size="20" value="" maxlength="45" id="d3">
<form>

<br><br>
<form method="post" action="">
	<b>Change Map Size</b> (clears map!):
	<br>
	Width:
	<input type="text" size="2" value="<?php echo $map_width; ?>" maxlength="2" name="w">
	<br>
	Height:
	<input type="text" size="2" value="<?php echo $map_height; ?>" maxlength="2" name="h">
	<br>
	<input type="submit" name="submit" value="Reload Map">
<form>

<br>
<br>
Get Coordinates - Click on image at point (Clears Map!):<br>
<form action="" method="post">
	<input type="image" name="map" src="minimap.gif" value="Map" alt="map">
</form>

</tr></td></table>

</body>
<footer>
</footer>
</html>
